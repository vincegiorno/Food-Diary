define(["backbone","firebase","setup","config","models/food","backfire"],function(e,s,t,i,o){var r=e.Firebase.Collection.extend({initialize:function(e,s){var r=s.id;this.model=o,this.url=i.fbUrl+r+"/food",this.listenTo(t.messages,"foodToAdd",this.checkFood),this.listenTo(t.messages,"removeFood",this.removeFood),this.listenTo(t.messages,"closeList",this.clearShow),this.listenTo(t.messages,"newDay",this.clearToday),this.listenTo(t.messages,"searchList",this.searchList)},checkFood:function(e){var s=this.findWhere({itemId:e.get("itemId")});if(s){var t=s.get("servings")+1;s.set({servings:t})}else this.add(e.attributes)},clearShow:function(){var e=[];this.each(function(s){s.set({show:!1}),e.push(s)}),this.reset(e)},clearToday:function(){var e=[];this.each(function(s){s.set({today:!1,servings:0}),e.push(s)}),this.reset(e)},searchList:function(e){var s,i,o,r=e.split(" "),a=[];this.each(function(e){s=!0,i=e.get("item"),i=i.toLowerCase();for(var t=r.length-1;t>=0;t--)if(i.indexOf(r[t].toLowerCase())<0){s=!1;break}e.set({show:s}),s&&(o=!0),a.push(e)}),this.reset(a),t.messages.trigger("listSearchComplete",o)},removeFood:function(e){this.remove(e)}});return r});
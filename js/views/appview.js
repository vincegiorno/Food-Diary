define(["jquery","backbone","setup","config","models/totals","views/totals-view","collections/days","views/graph","collections/foodlist","views/foodlist-view","views/api-results-view"],function(e,s,t,i,n,o,a,c,l,r,d){var h,g,u,w,f,v,m=s.View.extend({el:"body",initialize:function(e,s){var i=s.id;h=new a([],{id:i}),u=new l([],{id:i}),h.once("sync",function(){g=new o({model:h.findWhere({date:0})||new n}),h.add(g.model.attributes),g.close(),g=new o({model:h.findWhere({date:0})}),f=new c({collection:h})}),u.once("sync",function(){w=new r({collection:u})}),this.listenTo(t.messages,"listSearchComplete",this.openListResults),this.listenTo(t.messages,"reviseMyList",this.showMyList),this.listenTo(t.messages,"reviseToday",this.goToday)},events:{"click #new-day":"changeDay","click #reset":"reset","click #search-dbase":"searchAPI","click #search-my-list":"searchList","click #show-list":"showMyList","click #graph-btn":"toggleGraph","click #done":"goToday"},changeDay:function(){return 0===g.model.get("calories")?!1:(t.messages.trigger("newDay"),this.closeLists(),g=new o({model:new n}),h.add(g.model.attributes),g.close(),g=new o({model:h.findWhere({date:0})}),void(w=new r({collection:u})))},reset:function(){localStorage.clear("food-diary-id"),document.location.reload(!0)},searchAPI:function(){var s=t.searchBox.val();if(""===s)return!1;s=encodeURIComponent(s);var n=i.ntrxUrl+s;return this.closeLists(),t.searchDbase.attr("value","Searching..."),e.getJSON(n,i.ntrxParams).done(function(e){var s=e.hits;t.searchDbase.attr("value","in database"),0===s.length?t.title.html("No matches. Try again or search the database."):v=new d({results:s})}).fail(function(){t.title.html("Search request failed. Please check your Internet connection and try again.")}),!1},searchList:function(e){return e=t.searchBox.val(),""===e?!1:(this.closeLists(),t.messages.trigger("searchList",e),!1)},showMyList:function(){return this.closeLists(),w=new r({collection:u,option:"all"}),t.listBtn.addClass("hidden"),!1},toggleGraph:function(){t.graphDiv.hasClass("hidden")?(t.graphDiv.removeClass("hidden"),t.graphBtn.text("Hide graph")):(t.graphDiv.addClass("hidden"),t.graphBtn.text("Show graph"))},goToday:function(){this.closeLists(),w=new r({collection:u}),t.listBtn.removeClass("hidden"),scrollTo(0,0)},openListResults:function(e){w=new r({collection:u,option:"results",isFound:e})},closeLists:function(){t.messages.trigger("closeList"),t.whichList=""}});return m});
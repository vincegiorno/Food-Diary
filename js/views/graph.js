define(["backbone","setup","jquery"],function(e,t){var i=e.View.extend({el:"#graph",initialize:function(){this.listenTo(this.collection,"add",this.render),this.ctx=this.el.getContext("2d"),this.render()},render:function(){var e,i,r,n,h,l,s,a=30,o=20,d=0,g=2e4,c=[],f=this.ctx;if(t.graphDiv.removeClass("hidden"),l=this.el.width=t.graphDiv.width()-5,window.screen.width<700?(this.el.height=170,ySteps=5):(this.el.height=280,ySteps=10),s=this.el.height-20,f.clearRect(0,0,l,s),n=this.collection.filter(function(e){return 0!==e.get("date")}),n.length<2)return void this.graphAlert();n.length>14&&(n=n.slice(n.length-14)),h=n.length;for(var p=0;h>p;p++){var v=c[p]=n[p].get("calories");g=g>v?v:g,d=v>d?v:d}if(0===d)return void this.graphAlert();for(g-=g%100+100,g=0>g?0:g,d+=100-d%100,i=(s-o)/(d-g),r=(d-g)/ySteps,e=(l-a-5)/(h-1),f.strokeStyle="black",f.lineWidth=2,f.beginPath(),f.moveTo(a,o),f.lineTo(a,s),f.lineTo(l,s),f.stroke(),f.textBaseline="middle",p=0;p<=ySteps;p++)f.fillText(d-p*r,0,o+p*s/(ySteps+1));for(f.textBaseline=top,f.fillText("Calorie totals for the last "+h+" days",60,s+10),f.beginPath(),f.strokeStyle="#337ab7",f.moveTo(a,s-(c[0]-g)*i),p=1;h>p;p++)f.lineTo(a+e*p,s-(c[p]-g)*i);for(f.stroke(),p=0;h>p;p++)f.beginPath(),f.arc(a+e*p,s-(c[p]-g)*i,2,0,2*Math.PI,!0),f.fill();window.screen.width<400?t.graphBtn.removeClass("hidden"):t.graphBtn.addClass("hidden")},graphAlert:function(){t.alertGraph.removeClass("hidden"),setTimeout(function(){t.alertGraph.addClass("hidden"),t.graphDiv.addClass("hidden")},3e3)}});return i});